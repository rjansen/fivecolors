language: go
sudo: true

cache:
  directories:
    - $HOME/.cache/go-build
    - $HOME/gopath/pkg/mod
    - ./tmp

go:
    - 1.11.x
    - 1.12.x
    - 1.13.x
env:
    - OS=linux ARCH=amd64 TMP_DIR=/tmp MODULE=core
    - OS=linux ARCH=amd64 TMP_DIR=/tmp MODULE=function
    - OS=linux ARCH=amd64 TMP_DIR=/tmp MODULE=cmd/server

install: sudo make codecov.install gotestsum.install migrate.install

before_script:
    - sudo /etc/init.d/postgresql stop
    - make postgres.start firestore.start migrate.up

script: make ci

# after_script: make postgres.kill firestore.kill

after_success: make codecov.push

notifications:
    email:
        on_success: change
        on_failure: always

services:
    - docker
