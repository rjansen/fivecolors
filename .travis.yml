language: go
sudo: true

cache:
  directories:
    - $HOME/.cache/go-build
    - $HOME/gopath/pkg/mod
    - ./tmp/deps

go:
    - 1.11.x
env:
    - MODULE=core
    - MODULE=function
    - MODULE=cmd/server

install: sudo make setup module.setup postgres.setup clean

before_script:
    - sudo /etc/init.d/postgresql stop
    - make postgres.migrations.run firestore.decodekeycontent

script: make ci

after_script: make postgres.kill

after_success: make coverage.push

notifications:
    email:
        on_success: change
        on_failure: always

services:
    - docker
